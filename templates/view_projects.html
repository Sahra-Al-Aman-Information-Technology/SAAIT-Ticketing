<!DOCTYPE html>
<html lang="en">
 
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Projects Dashboard</title>
  <style>
    /* ===== Global ===== */
    body {
      font-family: "Segoe UI", Roboto, sans-serif;
      margin: 0;
      background-color: #f4f5f7;
      color: #1e1e1e;
    }
 
    /* ===== Header ===== */
    header {
      display: flex;
      justify-content: space-between;
      align-items: center;
      background-color: #ffffff;
      padding: 14px 40px;
      border-bottom: 1px solid #e0e0e0;
      position: sticky;
      top: 0;
      z-index: 10;
    }
 
    header h1 {
      font-size: 20px;
      font-weight: 600;
      color: #222;
      letter-spacing: 0.3px;
      margin: 0;
    }
 
    #backBtn {
      background: black;
      border: none;
      border-radius: 5px;
      color: white;
      font-size: 14px; /* slightly bigger font */
      cursor: pointer;
      margin-right: 12px;
      transition: color 0.2s;
      padding: 6px 12px; /* adjusted padding */
    }
 
    #backBtn:hover {
      background: white;
      color: black;
      border: 1px solid black;
    }
 
    #createProjectBtn {
      background-color: #0078d4;
      color: white;
      border: none;
      padding: 6px 12px;
      font-size: 14px;
      border-radius: 5px;
      cursor: pointer;
      transition: background-color 0.2s;
    }
 
    #createProjectBtn:hover {
      background-color: #0064b1;
    }
 
    /* ===== Search ===== */
    .search-section {
      display: flex;
      justify-content: center;
      margin: 20px auto 10px;
      width: 90%;
      max-width: 1200px;
    }
 
    .search-section input {
      width: 100%;
      max-width: 400px;
      padding: 10px 14px;
      border: 1px solid #ccc;
      border-radius: 6px;
      font-size: 14px;
      transition: border 0.2s ease;
    }
 
    .search-section input:focus {
      border-color: #0078d4;
      outline: none;
    }
 
    /* ===== Cards ===== */
    #projectContainer {
      display: grid;
      grid-template-columns: repeat(auto-fill, minmax(280px, 1fr));
      gap: 20px;
      padding: 25px 40px 40px;
      max-width: 1400px;
      margin: 0 auto;
    }
 
    .project-card {
      background: #fff;
      border: 1px solid #e6e6e6;
      border-radius: 8px;
      padding: 20px;
      box-shadow: 0 1px 3px rgba(0, 0, 0, 0.05);
      transition: box-shadow 0.25s ease, transform 0.2s ease;
    }
 
    .project-card:hover {
      transform: translateY(-3px);
      box-shadow: 0 2px 10px rgba(0, 0, 0, 0.08);
    }
 
    .project-header {
      display: flex;
      justify-content: space-between;
      align-items: center;
      margin-bottom: 12px;
    }
 
    .project-id {
      font-size: 13px;
      font-weight: 600;
      color: #0078d4;
    }
 
    .project-status {
      font-size: 13px;
      font-weight: 600;
      padding: 4px 10px;
      border-radius: 12px;
      color: #fff;
    }
 
    .status-active {
      background-color: #2e8b57;
    }
 
    .status-inactive {
      background-color: #999;
    }
 
    .project-name {
      font-size: 16px;
      font-weight: 600;
      color: #222;
      margin-bottom: 6px;
    }
 
    .project-client {
      font-size: 14px;
      color: #555;
      margin-bottom: 4px;
    }
 
    .project-date {
      font-size: 13px;
      color: #777;
      margin-bottom: 15px;
    }
 
    .action-btns {
      display: flex;
      justify-content: space-between;
      flex-wrap: wrap;
      gap: 4px;
    }
 
    .action-btn {
      flex: 1;
      text-align: center;
      cursor: pointer;
      border: none;
      font-size: 12px;
      padding: 4px;
      border-radius: 5px;
      transition: all 0.2s;
    }
 
    .view-btn {
      background-color: #0078d4;
      color: white;
    }
 
    .subject-btn {
      background-color: #7a7a7a;
      color: white;
    }
 
    .status-btn {
      background-color: #2e8b57;
      color: white;
    }
 
    .priority-btn {
      background-color: #c23b22;
      color: white;
    }
 
    .action-btn:hover {
      opacity: 0.9;
    }
 
    /* ===== Modal ===== */
    .modal {
      display: none;
      position: fixed;
      z-index: 1000;
      padding-top: 100px;
      left: 0;
      top: 0;
      width: 100%;
      height: 100%;
      background-color: rgba(0, 0, 0, 0.25);
    }
 
    .modal-content {
      background-color: #fff;
      margin: auto;
      padding: 25px;
      border-radius: 8px;
      width: 400px;
      box-shadow: 0 5px 15px rgba(0, 0, 0, 0.15);
    }
 
    .modal-content h3 {
      text-align: center;
      margin-bottom: 15px;
      color: #222;
      font-weight: 600;
    }
 
    .modal-content label {
      display: block;
      margin-top: 10px;
      font-weight: 500;
      font-size: 14px;
    }
 
    .modal-content input,
    .modal-content select {
      width: 100%;
      padding: 8px;
      margin-top: 5px;
      margin-bottom: 12px;
      border: 1px solid #ccc;
      border-radius: 6px;
      font-size: 14px;
      transition: border 0.2s;
    }
 
    .modal-content input:focus,
    .modal-content select:focus {
      border-color: #0078d4;
      outline: none;
    }
 
    .modal-content button {
      background-color: #0078d4;
      color: white;
      padding: 9px;
      font-size: 14px;
      width: 100%;
      border: none;
      border-radius: 6px;
      cursor: pointer;
      font-weight: 500;
    }
 
    .modal-content button:hover {
      background-color: #0064b1;
    }
 
    .close {
      color: #888;
      float: right;
      font-size: 22px;
      cursor: pointer;
      transition: color 0.2s;
    }
 
    .close:hover {
      color: #000;
    }
  </style>
</head>
 
<body>
  <header>
    <div style="display:flex;align-items:center;">
      <button id="backBtn">‚Üê Back</button>
    </div>
    <div style="display: flex;align-items: center;">
      <h1>Projects </h1>
    </div>
    <button id="createProjectBtn">+ Create Project</button>
  </header>
 
  <div class="search-section">
    <input type="text" id="searchInput" placeholder="Search project by name...">
  </div>
 
  <div id="projectContainer"></div>
 
  <!-- Modal -->
  <div id="createProjectModal" class="modal">
    <div class="modal-content">
      <span class="close" id="closeModal">&times;</span>
      <h3>Create New Project</h3>
      <form id="projectForm">
        <label>Project ID *</label>
        <input type="text" id="ProjectID" name="ProjectID" readonly required>
 
        <label>Project Name *</label>
        <input type="text" id="ProjectName" name="ProjectName" required>
 
        <label>Client *</label>
        <select id="ClientDropdown" name="ClientID" required>
          <option value="">Select Client</option>
        </select>
 
        <label>Created Date *</label>
        <input type="date" id="CreatedDate" name="CreatedDate" required>
 
        <label>Status *</label>
        <select id="Status" name="Status" required>
          <option value="Active">Active</option>
          <option value="Inactive">Inactive</option>
        </select>
 
        <button type="submit">Create Project</button>
      </form>
    </div>
  </div>
 
  <script>
    document.getElementById("backBtn").addEventListener("click", () => {
      window.location.href = "Saait.html";
    });
 
    async function loadClients() {
      try {
        const res = await fetch("/get_active_clients");
        const clients = await res.json();
        const dropdown = document.getElementById("ClientDropdown");
        dropdown.innerHTML = '<option value="">Select Client</option>';
        clients.forEach(c => {
          const opt = document.createElement("option");
          opt.value = c.ClientID;
          opt.text = c.ClientName;
          dropdown.appendChild(opt);
        });
      } catch (err) { console.error(err); }
    }
 
    document.getElementById("createProjectBtn").addEventListener("click", async () => {
      const res = await fetch("/get_next_project_id");
      const data = await res.json();
      document.getElementById("ProjectID").value = data.next_id || "";
      loadClients();
 
      // ‚úÖ Set current date by default but keep editable
      const today = new Date().toISOString().split('T')[0];
      document.getElementById("CreatedDate").value = today;
 
      document.getElementById("createProjectModal").style.display = "block";
    });
 
    document.getElementById("closeModal").addEventListener("click", () => {
      document.getElementById("createProjectModal").style.display = "none";
    });
 
    window.onclick = (event) => {
      if (event.target === document.getElementById("createProjectModal"))
        document.getElementById("createProjectModal").style.display = "none";
    };
 
    async function loadProjects() {
      const container = document.getElementById("projectContainer");
      try {
        const res = await fetch("/get_projects");
        const projects = await res.json();
        container.innerHTML = "";
 
        if (!projects.length) {
          container.innerHTML = `<p style="text-align:center; color:#666;">No projects found</p>`;
          return;
        }
 
        projects.forEach(p => {
          const card = document.createElement("div");
          card.className = "project-card";
          card.innerHTML = `
          <div class="project-header">
            <span class="project-id">#${p.ProjectID}</span>
            <span class="project-status ${p.Status === 'Active' ? 'status-active' : 'status-inactive'}">${p.Status}</span>
          </div>
          <div class="project-name">${p.ProjectName}</div>
          <div class="project-client">üë§ ${p.ClientName || '-'}</div>
          <div class="project-date">üìÖ ${p.CreatedDate || ''}</div>
          <div class="action-btns">
            <button class="action-btn view-btn" onclick="viewProject(${p.ProjectID})">View</button>
            <button class="action-btn subject-btn" onclick="viewSubjects(${p.ProjectID})">Subject</button>
            <button class="action-btn status-btn" onclick="viewStatus(${p.ProjectID})">Status</button>
            <button class="action-btn priority-btn" onclick="viewPriority(${p.ProjectID})">Priority</button>
          </div>`;
          container.appendChild(card);
        });
 
        document.getElementById("searchInput").addEventListener("input", (e) => {
          const term = e.target.value.toLowerCase();
          document.querySelectorAll(".project-card").forEach(card => {
            const name = card.querySelector(".project-name").textContent.toLowerCase();
            card.style.display = name.includes(term) ? "block" : "none";
          });
        });
      } catch (err) { console.error(err); }
    }
 
    function viewProject(id) { window.location.href = `/view_stream?project_id=${id}`; }
    function viewSubjects(id) { window.location.href = `/manage_subject.html?project_id=${id}`; }
    function viewStatus(id) { window.location.href = `/Status.html?project_id=${id}`; }
    function viewPriority(id) { window.location.href = `/priority.html?project_id=${id}`; }
 
    document.getElementById("projectForm").addEventListener("submit", async function (e) {
      e.preventDefault();
      const formData = new FormData(this);
      const res = await fetch("/add_project", { method: "POST", body: formData });
      const result = await res.json();
      if (result.success) {
        alert("‚úÖ " + result.message);
        document.getElementById("createProjectModal").style.display = "none";
        this.reset();
        loadProjects();
      } else {
        alert("‚ùå " + result.message);
      }
    });
 
    loadProjects();
    window.addEventListener("pageshow", () => loadProjects());
  </script>
</body>
 
</html>
 
 